name: Safari Video Factory
on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ'
        required: true
      video_name:
        description: 'Ø§Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ'
        required: true

jobs:
  convert-and-log:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4

      - name: Install Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
          pip install yt-dlp

      - name: Create Videos Directory
        run: mkdir -p videos

      - name: Download & Convert
        run: |
          yt-dlp -f "bestvideo+bestaudio/best" "${{ github.event.inputs.video_url }}" -o "raw_video"
          ffmpeg -i raw_video -vcodec libx264 -acodec aac -movflags +faststart "videos/${{ github.event.inputs.video_name }}.mp4"
          rm raw_video

      - name: Save Video
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "VideoBot"
          git add videos/*.mp4
          git commit -m "Add video: ${{ github.event.inputs.video_name }}"
          git push

      - name: ğŸ“‹ PRINT DATA FOR FIREBASE
        run: |
          REPO_NAME="${{ github.repository }}"
          DIRECT_URL="https://raw.githubusercontent.com/$REPO_NAME/main/videos/${{ github.event.inputs.video_name }}.mp4"
          
          echo "--------------------------------------------------"
          echo "ğŸš€ Ø§Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ÙˆØ§Ø¯Ø®Ù„Ù‡Ø§ ÙÙŠ Firebase:"
          echo "--------------------------------------------------"
          echo "NAME: ${{ github.event.inputs.video_name }}"
          echo "URL: $DIRECT_URL"
          echo "GROUP_ID: Ù„ÙˆØ³"
          echo "--------------------------------------------------"

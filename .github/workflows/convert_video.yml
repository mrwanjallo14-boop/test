name: Remote Video Downloader & Converter

on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'ضع رابط الفيديو هنا'
        required: true

jobs:
  download_and_convert:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Tools (yt-dlp & ffmpeg)
        run: |
          sudo curl -L https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp -o /usr/local/bin/yt-dlp
          sudo chmod a+rx /usr/local/bin/yt-dlp
          sudo apt-get update && sudo apt-get install -y ffmpeg

      - name: Download and Convert
        run: |
          mkdir -p output
          yt-dlp -f "bestvideo[ext=mp4]+bestaudio[ext=m4a]/best[ext=mp4]/best" \
          --merge-output-format mp4 \
          -o "output/%(title)s.%(ext)s" \
          "${{ github.event.inputs.video_url }}"

      - name: Upload to GitHub Releases (Direct Link)
        uses: softprops/action-gh-release@v1
        with:
          tag_name: converted-videos
          files: output/*.mp4
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
